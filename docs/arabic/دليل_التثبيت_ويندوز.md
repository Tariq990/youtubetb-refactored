# YouTubeTB - دليل التثبيت على ويندوز

## 🚀 البدء السريع (5 دقائق)

### المتطلبات
- Windows 10/11
- Python 3.10+ ([تحميل](https://www.python.org/downloads/))
- FFmpeg ([دليل التثبيت](#تثبيت-ffmpeg))
- اتصال بالإنترنت

---

## 📦 التثبيت

### الخطوة 1: تشغيل سكربت التثبيت التلقائي

افتح PowerShell في مجلد المشروع وشغّل:

```powershell
powershell -ExecutionPolicy Bypass -File setup_windows.ps1
```

هذا السكربت سيقوم بـ:
- ✅ فحص تثبيت Python
- ✅ فحص تثبيت FFmpeg
- ✅ إنشاء البيئة الافتراضية (virtual environment)
- ✅ تثبيت جميع المكتبات المطلوبة
- ✅ تثبيت متصفح Playwright
- ✅ إعداد ملف `.env`
- ✅ إنشاء المجلدات المطلوبة

---

## 🔑 الخطوة 2: إضافة مفاتيح الـ API

### المفاتيح المطلوبة

عدّل ملف `.env` وأضف مفاتيحك:

```env
# YouTube API (لجلب البيانات ومزامنة قاعدة البيانات)
YT_API_KEY=ضع_مفتاح_يوتيوب_هنا

# Google Gemini AI (لتوليد المحتوى)
GEMINI_API_KEY=ضع_مفتاح_جيميناي_هنا

# ElevenLabs (للتحويل النصي الصوتي عالي الجودة - اختياري)
ELEVENLABS_API_KEY=ضع_مفتاح_إليفن_لابز_هنا
```

### كيفية الحصول على المفاتيح

#### 1. YouTube Data API v3
1. اذهب إلى [Google Cloud Console](https://console.cloud.google.com)
2. أنشئ مشروع جديد
3. فعّل "YouTube Data API v3"
4. أنشئ Credentials → API Key
5. انسخ والصق في `.env`

#### 2. Google Gemini API
1. اذهب إلى [Google AI Studio](https://makersuite.google.com/app/apikey)
2. اضغط "Create API Key"
3. انسخ والصق في `.env`

#### 3. ElevenLabs (اختياري)
1. سجّل في [ElevenLabs](https://elevenlabs.io)
2. اذهب إلى Profile → API Keys
3. انسخ والصق في `.env`

**بديل مجاني:** استخدم Edge TTS (لا يحتاج مفتاح API)

---

## 🎬 الخطوة 3: إعداد OAuth لرفع الفيديوهات

### إنشاء بيانات OAuth

1. **إنشاء OAuth Client**
   - اذهب إلى [Google Cloud Console](https://console.cloud.google.com)
   - APIs & Services → Credentials
   - أنشئ OAuth 2.0 Client ID
   - نوع التطبيق: "Desktop app"
   - حمّل ملف JSON

2. **ضعه في المشروع**
   ```
   secrets/client_secret.json
   ```

3. **أول رفع للفيديو**
   - المتصفح سينفتح تلقائياً
   - سجّل دخول وامنح الصلاحيات
   - `token.json` سيتم إنشاؤه (قابل لإعادة الاستخدام)

---

## 🍪 الخطوة 4: إعداد الكوكيز (اختياري)

للفيديوهات المحظورة حسب العمر أو الموقع الجغرافي:

### تصدير الكوكيز

1. **تثبيت إضافة المتصفح**
   - [Chrome: Get cookies.txt](https://chrome.google.com/webstore/detail/get-cookiestxt/bgaddhkoddajcdgocldbbfleckgcbcid)
   - [Firefox: cookies.txt](https://addons.mozilla.org/en-US/firefox/addon/cookies-txt/)

2. **التصدير من يوتيوب**
   - سجّل دخول إلى YouTube
   - افتح أي فيديو
   - اضغط أيقونة الإضافة → Export
   - احفظ الملف

3. **ضعه في المشروع**
   ```
   secrets/cookies.txt
   ```

---

## ⚙️ تثبيت FFmpeg

### الطريقة 1: Chocolatey (موصى بها)

```powershell
# تثبيت Chocolatey (إذا لم يكن مثبتاً)
Set-ExecutionPolicy Bypass -Scope Process -Force
[System.Net.ServicePointManager]::SecurityProtocol = [System.Net.ServicePointManager]::SecurityProtocol -bor 3072
iex ((New-Object System.Net.WebClient).DownloadString('https://community.chocolatey.org/install.ps1'))

# تثبيت FFmpeg
choco install ffmpeg
```

### الطريقة 2: التثبيت اليدوي

1. حمّل: https://www.gyan.dev/ffmpeg/builds/
2. فك الضغط إلى: `C:\ffmpeg`
3. أضف إلى PATH:
   - ابحث في ويندوز عن "Environment Variables"
   - عدّل متغير "Path"
   - أضف: `C:\ffmpeg\bin`
   - اضغط OK
4. أعد تشغيل PowerShell

### التحقق من التثبيت
```powershell
ffmpeg -version
```

---

## 🎯 الاستخدام

### تفعيل البيئة الافتراضية
**شغّل هذا دائماً أولاً:**
```powershell
.\venv\Scripts\activate
```

### تشغيل البرنامج
```powershell
python main.py
```

### خيارات القائمة التفاعلية

1. **معالجة كتاب واحد** - عملية كاملة لكتاب واحد
2. **المعالجة الدفعية** - معالجة عدة كتب من ملف
3. **استئناف العملية** - الاستمرار من حيث توقف
4. **إنشاء Short** - إنشاء فيديو قصير من الفيديو الأساسي
5. **إنشاء صورة مصغرة** - إنشاء thumbnail مخصص
6. **فحص الـ APIs** - التحقق من جميع المفاتيح
7. **مزامنة قاعدة البيانات** - التحديث من قناة YouTube
8. والمزيد...

---

## 📁 هيكل المشروع

```
youtubetb_refactored/
├── .env                    # مفاتيح API (يجب تعديله)
├── .env.example           # نموذج
├── setup_windows.ps1      # سكربت التثبيت التلقائي
├── main.py                # نقطة الدخول الرئيسية
├── requirements.txt       # المكتبات المطلوبة
├── TROUBLESHOOTING.md     # حلول للمشاكل الشائعة
├── secrets/               # البيانات السرية
│   ├── client_secret.json # YouTube OAuth (مطلوب للرفع)
│   ├── token.json         # يتم إنشاؤه تلقائياً
│   ├── cookies.txt        # كوكيز المتصفح (اختياري)
│   └── api_key.txt        # بديل لـ .env
├── config/                # ملفات الإعدادات
│   └── settings.json      # إعدادات التطبيق
├── runs/                  # مجلد المخرجات
│   └── BOOK_NAME/         # لكل كتاب مجلده الخاص
│       ├── output.mp4     # الفيديو النهائي
│       ├── output.titles.json
│       ├── bookcover.jpg
│       └── ...
├── src/                   # الكود المصدري
└── venv/                  # البيئة الافتراضية
```

---

## 🔍 التحقق السريع

### فحص التثبيت
```powershell
# تفعيل البيئة الافتراضية
.\venv\Scripts\activate

# فحص المكتبات المثبتة
pip list

# فحص الـ APIs
python -m src.presentation.cli.check_apis

# فحص FFmpeg
ffmpeg -version

# فحص Playwright
python -c "from playwright.sync_api import sync_playwright; print('OK')"
```

---

## 🛠️ الأوامر الشائعة

```powershell
# تفعيل البيئة الافتراضية
.\venv\Scripts\activate

# تشغيل البرنامج الرئيسي
python main.py

# معالجة كتاب محدد
python main.py --book "Atomic Habits"

# المعالجة الدفعية من ملف
python main.py --batch books.txt

# فحص حالة الـ APIs
python -m src.presentation.cli.check_apis

# مزامنة قاعدة البيانات من YouTube
python -m src.infrastructure.adapters.database sync

# إنشاء thumbnail لفيديو موجود
python -m src.infrastructure.adapters.thumbnail --run runs/YOUR_BOOK

# رفع فيديو يدوياً
python -m src.infrastructure.adapters.youtube_upload --run runs/YOUR_BOOK
```

---

## ⚠️ حل المشاكل الشائعة

### المشكلة: "Python not found"
**الحل:** ثبّت Python 3.10+ وفعّل "Add Python to PATH" أثناء التثبيت

### المشكلة: "FFmpeg not found"
**الحل:** اتبع قسم [تثبيت FFmpeg](#تثبيت-ffmpeg)

### المشكلة: "Module not found"
**الحل:** 
```powershell
.\venv\Scripts\activate
pip install -r requirements.txt
```

### المشكلة: "الكوكيز لا تعمل"
**الحل:** أعد تصدير الكوكيز من المتصفح (تنتهي صلاحيتها)

### المشكلة: "فشل جلب غلاف أمازون"
**الحل:** راجع `TROUBLESHOOTING.md` - تم تطبيق حل بـ Playwright

### المشكلة: "فشلت مزامنة قاعدة البيانات"
**الحل:** تحقق من مفتاح YouTube API ومعرّف القناة في الإعدادات

**للمزيد:** راجع [TROUBLESHOOTING.md](TROUBLESHOOTING.md)

---

## 📚 الخطوات التالية

بعد التثبيت:

1. **ضبط الإعدادات** - عدّل `config/settings.json` حسب تفضيلاتك
2. **جرّب كتاب واحد** - عالج كتاب بسيط أولاً
3. **إعداد المعالجة الدفعية** - أنشئ `books.txt` بقائمة كتبك
4. **استكشف المزايا** - راجع القائمة التفاعلية للخيارات

---

## 📖 الوثائق

- **[TROUBLESHOOTING.md](TROUBLESHOOTING.md)** - حلول للمشاكل الشائعة
- **[WINDOWS_SETUP.md](WINDOWS_SETUP.md)** - دليل التثبيت بالإنجليزية
- **[README.md](README.md)** - وثائق المشروع الكاملة
- **[YOUTUBE_SYNC_QUICKSTART.md](YOUTUBE_SYNC_QUICKSTART.md)** - دمج YouTube
- **[REFACTORING_CHANGELOG.md](REFACTORING_CHANGELOG.md)** - التحسينات الأخيرة

---

## 🎓 درس عملي: معالجة أول كتاب

### خطوة بخطوة

1. **تفعيل البيئة**
   ```powershell
   .\venv\Scripts\activate
   ```

2. **تشغيل البرنامج**
   ```powershell
   python main.py
   ```

3. **اختر الخيار 1** - معالجة كتاب واحد

4. **أدخل بيانات الكتاب**
   ```
   Book name: Atomic Habits
   Author: James Clear
   ```

5. **انتظر المعالجة**
   - المرحلة 1-4: توليد المحتوى (5-10 دقائق)
   - المرحلة 5-7: الصوت (5-10 دقائق)
   - المرحلة 8-9: الفيديو (10-20 دقيقة)
   - المرحلة 10: رفع YouTube (5 دقائق)

6. **تحقق من الناتج**
   ```
   runs/Atomic_Habits_James_Clear/output.mp4
   ```

---

## ⚡ نصائح للأداء

### تسريع المعالجة
- **استخدم Edge TTS** (مجاني وأسرع من ElevenLabs)
- **المعالجة الدفعية** ليلاً لعدة كتب
- **يُنصح بـ SSD** لعرض الفيديو
- **أغلق التطبيقات الثقيلة** أثناء المعالجة

### توفير API Quota
- **جرّب كتب قصيرة** أولاً
- **استخدم خاصية الاستئناف** إذا فشلت العملية
- **حفظ الأغلفة محلياً** (prefer_local_cover: true)

---

## 🔒 ملاحظات أمنية

- **لا ترفع `.env`** إلى git أبداً
- **احفظ مجلد `secrets/` خاصاً**
- **لا تشارك `token.json`** (يحتوي صلاحياتك لـ YouTube)
- **غيّر مفاتيح API** بانتظام
- **استخدم `.gitignore`** بشكل صحيح

---

## 🆘 طلب المساعدة

1. **اقرأ رسائل الخطأ** بعناية
2. **راجع [TROUBLESHOOTING.md](TROUBLESHOOTING.md)**
3. **تحقق من جميع المتطلبات** مثبتة
4. **جرّب مثال بسيط** أولاً
5. **راجع مشاكل المشروع** على GitHub

---

## ✅ قائمة التحقق من التثبيت

- [ ] Python 3.10+ مثبت
- [ ] FFmpeg مثبت وفي PATH
- [ ] البيئة الافتراضية منشأة (مجلد `venv` موجود)
- [ ] جميع المكتبات مثبتة (`pip list` يُظهر المكتبات)
- [ ] متصفح Playwright مثبت
- [ ] ملف `.env` موجود مع مفاتيح API
- [ ] `secrets/client_secret.json` لرفع YouTube
- [ ] `config/settings.json` مُعد
- [ ] مُختبر بـ `python -m src.presentation.cli.check_apis`

---

**جاهز للبدء!** 🎉

شغّل: `python main.py`

---

**تحتاج مساعدة؟** راجع [TROUBLESHOOTING.md](TROUBLESHOOTING.md)
