<!DOCTYPE html>
<html lang="en" dir="ltr">
<head>
	<meta charset="UTF-8">
	<meta name="viewport" content="width=device-width, initial-scale=1.0">
	<title>Pro Video Template</title>
	<script src="https://cdn.tailwindcss.com"></script>
	<link rel="preconnect" href="https://fonts.googleapis.com">
	<link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
	<link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;700;900&display=swap" rel="stylesheet">
	<script src="https://cdnjs.cloudflare.com/ajax/libs/color-thief/2.3.0/color-thief.umd.js"></script>

	<style>
		body { font-family: 'Inter', sans-serif; }
		#blurred-bg {
			position: absolute; inset: -2.5rem; background-size: cover; background-position: center;
			filter: blur(30px) brightness(0.45); z-index: 1; transition: background-image 0.5s ease-in-out;
			/* much slower/subtler pan to reduce motion */
			animation: subtlePan 120s ease-in-out infinite alternate;
		}
		@keyframes spin { from { transform: rotate(0deg); } to { transform: rotate(360deg); } }
		/* smooth rotation - noticeable but not distracting */
		.animate-spin-slow { animation: spin 60s linear infinite; }
	/* Modern waveform animation with varying heights */
	.waveform-bar {
		animation: waveform 1.2s ease-in-out infinite alternate;
		transform-origin: center;
	}
	@keyframes waveform {
		0% { transform: scaleY(0.2); opacity: 0.6; }
		50% { transform: scaleY(1); opacity: 1; }
		100% { transform: scaleY(0.3); opacity: 0.7; }
	}
		@keyframes subtlePan {
			/* smooth breathe effect - very subtle zoom in/out + pan */
			0% { transform: scale(1.05) translate(-1%, -1%); }
			50% { transform: scale(1.08) translate(1%, 1%); }
			100% { transform: scale(1.05) translate(-1%, -1%); }
		}
		#video-preview-container {
			width: 1920px !important; height: 1080px !important;
			max-width: 1920px !important; max-height: 1080px !important;
		}
		/* aspect ratio helper to replace inline padding-top */
		.preview-aspect { padding-top: 56.25%; }

		/* default blurred background image (will be updated by JS) */
		#blurred-bg { background-image: url('https://placehold.co/800x450/333333/111827?text=Book'); }

		/* waveform animation delay helpers to avoid inline styles */
		.waveform-delay-1 { animation-delay: -0.1s; }
		.waveform-delay-2 { animation-delay: -0.2s; }
		.waveform-delay-3 { animation-delay: -0.3s; }
		.waveform-delay-4 { animation-delay: -0.4s; }
		.waveform-delay-5 { animation-delay: -0.5s; }
		.waveform-delay-6 { animation-delay: -0.6s; }
		.waveform-delay-7 { animation-delay: -0.7s; }
		.waveform-delay-8 { animation-delay: -0.8s; }
		@media not screen and (min-width: 1920px) {
			#video-preview-container {
				width: 100% !important; height: auto !important;
				max-width: 100% !important; max-height: none !important;
			}
		}

		/* Improved cover frame styling */
		.cover-frame {
			position: absolute; /* occupy the square container */
			inset: 0;
			padding: 17px; /* exact requested thickness */
			border-radius: 1.25rem; /* close to rounded-2xl */
			background: linear-gradient(135deg,
				rgba(255,255,255,0.35),
				rgba(255,255,255,0.08),
				rgba(0,0,0,0.35)
			);
			box-shadow:
				0 20px 40px rgba(0,0,0,0.45), /* outer drop */
				inset 0 0 0 1px rgba(255,255,255,0.08); /* stronger inner hairline to match thickness */
			z-index: 30;
		}
		.cover-inner {
			position: relative;
			width: 100%;
			height: 100%;
			border-radius: 1rem;
			overflow: hidden;
			background: rgba(0,0,0,0.20); /* Original semi-transparent background */
			-webkit-backdrop-filter: blur(8px);
			backdrop-filter: blur(8px);
			border: 1px solid rgba(255,255,255,0.08); /* slightly stronger to complement outer frame */
			box-shadow:
				inset 0 1px 0 rgba(255,255,255,0.05), /* top sheen */
				inset 0 0 30px rgba(0,0,0,0.35); /* inner depth */
		}
		.cover-img {
		width: 100%;
		height: 100%;
		object-fit: cover; /* Fill width, crop height if needed */
		object-position: top; /* Prioritize top of book cover, crop bottom */
		border-radius: inherit;
			transform: translateZ(0); /* avoid blit artifacts */
		}
		.cover-gloss {
			pointer-events: none;
			position: absolute;
			inset: 0;
			background: linear-gradient(to bottom,
				rgba(255,255,255,0.14),
				rgba(255,255,255,0.0) 30%,
				rgba(0,0,0,0.0) 70%,
				rgba(0,0,0,0.25)
			);
			mix-blend-mode: screen;
		}
	</style>
	<!-- moved from project root to config/template.html -->
</head>
<body class="bg-gray-900 flex items-center justify-center min-h-screen py-8 text-white">
	<div class="container mx-auto p-4 max-w-7xl grid lg:grid-cols-11 gap-8 items-center">
		<div class="lg:col-span-4 bg-black/30 backdrop-blur-2xl p-8 rounded-2xl border border-white/10">
			<h1 class="text-3xl font-black mb-2">Pro Video Template</h1>
			<p class="text-white/50 mb-8">Customize elements for professional video preview.</p>
			<div class="space-y-6">
				<div>
					<label for="image-upload" class="block text-sm font-bold text-white/70 mb-2 uppercase tracking-wider">Cover Image</label>
					<input type="file" id="image-upload" accept="image/*" class="w-full text-sm text-gray-300 file:mr-4 file:py-3 file:px-5 file:rounded-full file:border-0 file:text-sm file:font-semibold file:bg-red-500/20 file:text-red-300 hover:file:bg-red-500/40 cursor-pointer transition"/>
				</div>
				<div class="grid grid-cols-1 gap-4">
					<div>
						<label for="top-title-input" class="block text-sm font-bold text-white/70 uppercase tracking-wider">Top Title</label>
						<input type="text" id="top-title-input" value="BOOK SUMMARY" class="mt-1 w-full p-3 bg-white/5 border border-white/10 rounded-lg focus:ring-2 focus:ring-red-500 transition">
					</div>
					<div>
						<label for="main-title-input" class="block text-sm font-bold text-white/70 uppercase tracking-wider">Main Title</label>
						<input type="text" id="main-title-input" value="SERENITY" class="mt-1 w-full p-3 bg-white/5 border border-white/10 rounded-lg focus:ring-2 focus:ring-red-500 transition">
					</div>
					<div>
						<label for="subtitle-input" class="block text-base font-bold text-white/70 uppercase tracking-wider">Subtitle</label>
						<input type="text" id="subtitle-input" value="SOOTHING THE MIND" class="mt-1 w-full p-3 bg-white/5 border border-white/10 rounded-lg focus:ring-2 focus:ring-red-500 transition">
					</div>
					<div>
						<label for="footer-input" class="block text-base font-bold text-white/70 mb-2 uppercase tracking-wider">Footer Text</label>
						<input type="text" id="footer-input" value="23 TECHNIQUES TO RELIEVE STRESS" class="mt-1 w-full p-3 bg-white/5 border border-white/10 rounded-lg focus:ring-2 focus:ring-red-500 transition">
					</div>
				</div>
				<div class="border-t border-white/10 pt-6">
					<h3 class="text-lg font-bold mb-4">Video Settings</h3>
					<div class="grid grid-cols-2 gap-4">
						<div>
							<label for="duration-input" class="block text-sm font-bold text-white/70 mb-2">Duration (sec)</label>
							<input type="number" id="duration-input" value="8" min="1" max="30" class="w-full p-3 bg-white/5 border border-white/10 rounded-lg focus:ring-2 focus:ring-red-500 transition">
						</div>
						<div>
							<label for="fps-input" class="block text-sm font-bold text-white/70 mb-2">FPS</label>
							<input type="number" id="fps-input" value="30" min="15" max="60" class="w-full p-3 bg-white/5 border border-white/10 rounded-lg focus:ring-2 focus:ring-red-500 transition">
						</div>
					</div>
				</div>
				<div class="pt-4">
					<button id="save-settings-btn" class="w-full py-4 px-6 rounded-xl text-white font-bold text-lg uppercase tracking-wider bg-gradient-to-r from-red-500 to-red-600 hover:from-red-600 hover:to-red-700 transition-all transform hover:scale-105">
						ðŸ’¾ Save Settings to JSON
					</button>
					<div class="mt-4 p-4 bg-blue-900/20 border border-blue-500/30 rounded-lg">
						<h4 class="text-sm font-bold text-blue-300 mb-2">ðŸ“‹ Next Steps:</h4>
						<ol class="text-xs text-blue-200 space-y-1 list-decimal list-inside">
							<li>Customize your video above</li>
							<li>Click "Save Settings to JSON"</li>
							<li>Run: <code class="bg-black/50 px-1 rounded">python render_video.py</code></li>
							<li>Video will be saved as "video_snap.mp4"</li>
						</ol>
					</div>
				</div>
			</div>
		</div>
		<div class="lg:col-span-7 w-full">
			<div class="w-full mx-auto relative preview-aspect">
				<div id="video-preview-container" class="absolute inset-0 w-full h-full bg-gradient-to-br from-[#1a1a1a] to-[#0a0a0a] overflow-hidden rounded-2xl shadow-2xl shadow-black/60">
					<div id="blurred-bg"></div>
					<div class="absolute -right-1/4 -top-1/4 w-3/4 h-auto aspect-square z-10 opacity-20">
						 <svg class="w-full h-full animate-spin-slow" viewBox="0 0 100 100" fill="none" xmlns="http://www.w3.org/2000/svg">
							<circle cx="50" cy="50" r="48" fill="#000"/><circle cx="50" cy="50" r="46" stroke="#111" stroke-width="1.5"/>
							<circle id="vinyl-accent" cx="50" cy="50" r="15" fill="#666"/><circle cx="50" cy="50" r="5" fill="#000"/>
						</svg>
					</div>
					<div class="absolute inset-0 z-20 p-10 flex flex-col justify-between text-white">
						<p id="top-title-preview" class="text-center text-base uppercase tracking-[0.5em] font-bold text-white/40">BOOK SUMMARY</p>
						<div class="flex-grow flex items-center justify-end gap-12 pr-24 lg:pr-32 transform-gpu translate-x-[4%] lg:translate-x-[6%]">
							<div class="relative w-[36%] flex-shrink-0 aspect-square">
								<div class="cover-frame">
									<div class="cover-inner">
										<img id="cover-art" src="https://placehold.co/561x561/f87171/111827?text=Stop+Overthinking" class="cover-img" alt="Cover art">
										<div class="cover-gloss"></div>
									</div>
								</div>
							</div>
											 <div class="w-[60%] flex flex-col items-center text-center space-y-8 lg:space-y-10">
												 <h3 id="main-title-preview" class="text-7xl font-black uppercase tracking-tight leading-none">SERENITY</h3>
												 <p id="subtitle-preview" class="text-2xl font-bold uppercase tracking-[0.2em] text-white/50 leading-tight mt-4">SOOTHING THE MIND</p>
												 <div class="flex items-center justify-center space-x-2 h-16 w-full max-w-xs mt-2">
								   <div class="waveform-bar w-3 h-full bg-gradient-to-t from-white/40 to-white/90 rounded-full waveform-delay-1"></div>
								   <div class="waveform-bar w-3 h-full bg-gradient-to-t from-white/40 to-white/90 rounded-full waveform-delay-2"></div>
								   <div class="waveform-bar w-3 h-full bg-gradient-to-t from-white/40 to-white/90 rounded-full waveform-delay-3"></div>
								   <div class="waveform-bar w-3 h-full bg-gradient-to-t from-white/40 to-white/90 rounded-full waveform-delay-4"></div>
								   <div class="waveform-bar w-3 h-full bg-gradient-to-t from-white/40 to-white/90 rounded-full waveform-delay-5"></div>
								   <div class="waveform-bar w-3 h-full bg-gradient-to-t from-white/40 to-white/90 rounded-full waveform-delay-6"></div>
								   <div class="waveform-bar w-3 h-full bg-gradient-to-t from-white/40 to-white/90 rounded-full waveform-delay-7"></div>
								   <div class="waveform-bar w-3 h-full bg-gradient-to-t from-white/40 to-white/90 rounded-full waveform-delay-8"></div>
							   </div>
							</div>
						</div>
						<p id="footer-preview" class="text-center text-base uppercase tracking-[0.5em] font-bold text-white/40">23 TECHNIQUES TO RELIEVE STRESS</p>
					</div>
				</div>
			</div>
		</div>
	</div>
	<script>
		const colorThief = new ColorThief();
		const imageUpload = document.getElementById('image-upload');
		const coverArt = document.getElementById('cover-art');
		const blurredBg = document.getElementById('blurred-bg');
		const videoPreviewContainer = document.getElementById('video-preview-container');
		const vinylAccent = document.getElementById('vinyl-accent');
		const topTitleInput = document.getElementById('top-title-input');
		const mainTitleInput = document.getElementById('main-title-input');
		const subtitleInput = document.getElementById('subtitle-input');
		const footerInput = document.getElementById('footer-input');
		const topTitlePreview = document.getElementById('top-title-preview');
		const mainTitlePreview = document.getElementById('main-title-preview');
		const subtitlePreview = document.getElementById('subtitle-preview');
		const footerPreview = document.getElementById('footer-preview');
		const durationInput = document.getElementById('duration-input');
		const fpsInput = document.getElementById('fps-input');
		const saveSettingsBtn = document.getElementById('save-settings-btn');

		function handleImageUpload(event) {
			const file = event.target.files[0];
			if (file) {
				const reader = new FileReader();
				reader.onload = (e) => {
					const imageUrl = e.target.result;
					coverArt.src = imageUrl;
					blurredBg.style.backgroundImage = `url(${imageUrl})`;
					const img = new Image();
					img.onload = function() {
						const dominantColor = colorThief.getColor(img);
						const [r, g, b] = dominantColor;
						const mainRgb = `rgb(${r}, ${g}, ${b})`;
						const darkRgb = `rgb(${Math.round(r * 0.7)}, ${Math.round(g * 0.7)}, ${Math.round(b * 0.7)})`;
						videoPreviewContainer.style.background = `linear-gradient(to bottom right, ${mainRgb}, ${darkRgb})`;
						vinylAccent.style.fill = mainRgb;
					};
					img.src = imageUrl;
				};
				reader.readAsDataURL(file);
			}
		}

		function updateAllText() {
			topTitlePreview.textContent = topTitleInput.value;
			mainTitlePreview.textContent = mainTitleInput.value;
			subtitlePreview.textContent = subtitleInput.value;
			footerPreview.textContent = footerInput.value;
		}

		function saveSettings() {
			const settings = {
				cover_image: coverArt.src,
				top_title: topTitleInput.value,
				main_title: mainTitleInput.value,
				subtitle: subtitleInput.value,
				footer: footerInput.value,
				duration: parseFloat(durationInput.value),
				fps: parseInt(fpsInput.value),
				width: 1920,
				height: 1080,
				created_at: new Date().toISOString()
			};

			const settingsJson = JSON.stringify(settings, null, 2);
			const blob = new Blob([settingsJson], { type: 'application/json' });
			const url = URL.createObjectURL(blob);

			const a = document.createElement('a');
			a.href = url;
			a.download = 'settings.json';
			document.body.appendChild(a);
			a.click();
			document.body.removeChild(a);
			URL.revokeObjectURL(url);

			alert('Settings saved to settings.json!\n\nNow run: python -m src.cli.run_pipeline "Your Query"');
		}

		imageUpload.addEventListener('change', handleImageUpload);
		[topTitleInput, mainTitleInput, subtitleInput, footerInput].forEach(input => {
			input.addEventListener('input', updateAllText);
		});
		saveSettingsBtn.addEventListener('click', saveSettings);

		blurredBg.style.backgroundImage = `url('${coverArt.src}')`;
	</script>
</body>
</html>
